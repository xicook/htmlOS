<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cobrinha</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f1724; --text:#e6eef8; --muted:#9fb1c9;
    --stroke: rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#071026, #09172a 50%, #071222);
       color:var(--text);font:15px/1.4 system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:820px;margin:0 auto;padding:16px}
  .top{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:8px}
  .left{display:flex;gap:12px;align-items:center}
  .card{background:var(--panel);border:1px solid var(--stroke);border-radius:16px;padding:12px}
  .button{padding:8px 12px;border:1px solid var(--stroke);border-radius:10px;background:#101a2a;color:var(--text);cursor:pointer}
  .button:active{transform:translateY(1px)}
  canvas{width:100%;max-width:720px;background:#08121d;border:1px solid var(--stroke);border-radius:12px;display:block;margin:10px auto}
  .dpad{display:flex;gap:12px;justify-content:center;margin-top:10px;flex-wrap:wrap}
  .hint{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="left card">
      <strong>Score:</strong> <span id="snScore">0</span>
      &nbsp;|&nbsp; <strong>Recorde:</strong> <span id="snBest">0</span>
    </div>
    <div class="card">
      <button id="snRestart" class="button">Reiniciar</button>
      <button id="snPause" class="button">Pausar</button>
    </div>
  </div>

  <canvas id="snCanvas" width="480" height="360"></canvas>

  <div class="dpad">
    <button class="button" data-dpad="left">◀</button>
    <button class="button" data-dpad="up">▲</button>
    <button class="button" data-dpad="down">▼</button>
    <button class="button" data-dpad="right">▶</button>
  </div>
  <p class="hint">Setas/WASD ou botões. Espaço pausa/continua.</p>
</div>

<script>
(function(){
  const cvs = document.getElementById('snCanvas');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('snScore');
  const bestEl = document.getElementById('snBest');
  const btnPause = document.getElementById('snPause');
  const btnRestart = document.getElementById('snRestart');
  const dpadBtns = document.querySelectorAll('[data-dpad]');

  const COLS = 24, ROWS = 18;
  const CELL = Math.floor(Math.min(cvs.width/COLS, cvs.height/ROWS));
  cvs.width = COLS*CELL; cvs.height = ROWS*CELL;

  let snake, dir, nextDir, food, score, best, running, tickMs, loopId;

  function initState(){
    snake = [{x:12,y:9}];
    dir = {x:1,y:0};
    nextDir = {x:1,y:0};
    food = null;
    score = 0;
    running = true;
    tickMs = 120;
    clearInterval(loopId); loopId = null;
    scoreEl.textContent = '0';
    if(best == null){ best = parseInt(localStorage.getItem('snake-best')||'0',10) || 0; }
    bestEl.textContent = String(best);
    draw();
  }

  function randFood(){
    while(true){
      const f = {x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS)};
      if(!snake.some(s => s.x===f.x && s.y===f.y)) return f;
    }
  }
  function setDir(nx,ny){
    if (nx === -dir.x && ny === -dir.y) return; // block 180º
    nextDir = {x:nx,y:ny};
  }
  function step(){
    dir = nextDir;
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    if(head.x<0 || head.y<0 || head.x>=COLS || head.y>=ROWS) return gameOver();
    if(snake.some(s => s.x===head.x && s.y===head.y)) return gameOver();
    snake.unshift(head);
    if(!food) food = randFood();
    if(head.x===food.x && head.y===food.y){
      score += 10; scoreEl.textContent = String(score);
      food = randFood();
      // acelera levemente
      if (tickMs > 70){ tickMs -= 2; restartLoop(); }
    } else {
      snake.pop();
    }
    draw();
  }
  function draw(){
    ctx.fillStyle = '#06101a'; ctx.fillRect(0,0,cvs.width,cvs.height);
    if(food){ ctx.fillStyle = '#f59e0b'; ctx.fillRect(food.x*CELL, food.y*CELL, CELL, CELL); }
    for(let i=0;i<snake.length;i++){
      const s = snake[i]; ctx.fillStyle = i===0 ? '#22d3ee' : '#60a5fa';
      ctx.fillRect(s.x*CELL, s.y*CELL, CELL, CELL);
    }
  }
  function gameOver(){
    running = false;
    clearInterval(loopId); loopId = null;
    ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle='#fff'; ctx.font='bold 24px sans-serif'; ctx.textAlign='center';
    ctx.fillText('Game Over', cvs.width/2, cvs.height/2 - 10);
    ctx.font='16px sans-serif'; ctx.fillText('Toque/Reinicie para jogar novamente', cvs.width/2, cvs.height/2 + 16);
    if(score > (best||0)){ best = score; localStorage.setItem('snake-best', String(best)); bestEl.textContent = String(best); }
  }
  function restartLoop(){
    clearInterval(loopId);
    loopId = setInterval(step, tickMs);
  }
  function start(){
    running = true;
    restartLoop();
    draw();
  }
  function pause(){
    running = !running;
    if(running){ start(); btnPause.textContent='Pausar'; }
    else { clearInterval(loopId); loopId = null; btnPause.textContent='Continuar'; }
  }
  function restart(){
    initState();
    start();
    btnPause.textContent='Pausar';
  }

  // Controls
  window.addEventListener('keydown', (e)=>{
    const k=e.key.toLowerCase();
    if(k==='arrowup'||k==='w') setDir(0,-1);
    else if(k==='arrowdown'||k==='s') setDir(0,1);
    else if(k==='arrowleft'||k==='a') setDir(-1,0);
    else if(k==='arrowright'||k==='d') setDir(1,0);
    else if(k===' '){ e.preventDefault(); pause(); }
  });
  dpadBtns.forEach(b=>b.addEventListener('click', ()=>{
    const d=b.getAttribute('data-dpad');
    if(d==='up') setDir(0,-1);
    if(d==='down') setDir(0,1);
    if(d==='left') setDir(-1,0);
    if(d==='right') setDir(1,0);
  }));
  btnPause.addEventListener('click', pause);
  btnRestart.addEventListener('click', restart);

  // First run
  initState();
  start();
})();
</script>
</body>
</html>
